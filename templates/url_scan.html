<!DOCTYPE html>
<html>
<head>
    <title>URL Phishing Scan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

{% include "navbar.html" %}

<div class="container mt-5">
    <div class="card shadow mx-auto p-4" style="max-width: 700px;">
        <h4 class="mb-3">URL Phishing Detection</h4>

        <div class="input-group mb-3">
            <input id="urlInput" type="text" class="form-control" placeholder="Enter URL to scan (e.g., http://example.com)">
            <button id="scanBtn" class="btn btn-primary">Scan</button>
        </div>

        <div id="errorBox" class="alert alert-danger d-none" role="alert"></div>

        <div id="resultBox" class="d-none">
            <p class="mb-1">
                Prediction:
                <span id="predictionBadge" class="badge"></span>
            </p>
            <p class="mb-3">Confidence: <strong id="confidenceText"></strong></p>

            <h6>Extracted Features</h6>
            <ul id="featuresList" class="list-group"></ul>
        </div>
    </div>
</div>

<script>
const scanBtn = document.getElementById("scanBtn");
const urlInput = document.getElementById("urlInput");
const errorBox = document.getElementById("errorBox");
const resultBox = document.getElementById("resultBox");
const predictionBadge = document.getElementById("predictionBadge");
const confidenceText = document.getElementById("confidenceText");
const featuresList = document.getElementById("featuresList");

function showError(message) {
    errorBox.classList.remove("d-none");
    errorBox.innerText = message;
}

function clearError() {
    errorBox.classList.add("d-none");
    errorBox.innerText = "";
}

function renderFeatures(features) {
    featuresList.innerHTML = "";
    Object.entries(features).forEach(([key, value]) => {
        const item = document.createElement("li");
        item.className = "list-group-item d-flex justify-content-between";
        item.innerHTML = `<span>${key}</span><strong>${value}</strong>`;
        featuresList.appendChild(item);
    });
}

scanBtn.addEventListener("click", async () => {
    clearError();
    resultBox.classList.add("d-none");

    const url = urlInput.value.trim();
    if (!url) {
        showError("Please provide a URL.");
        return;
    }

    try {
        const res = await fetch("/api/scan-url", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url })
        });
        const payload = await res.json();

        if (!res.ok) {
            showError(payload.error || "Failed to scan URL.");
            return;
        }

        const isPhishing = payload.prediction === "PHISHING";
        predictionBadge.className = `badge ${isPhishing ? "text-bg-danger" : "text-bg-success"}`;
        predictionBadge.innerText = payload.prediction;
        confidenceText.innerText = `${(payload.confidence * 100).toFixed(2)}%`;

        renderFeatures(payload.features || {});
        resultBox.classList.remove("d-none");
    } catch (err) {
        showError("Unexpected error while scanning URL.");
    }
});
</script>

</body>
</html>
